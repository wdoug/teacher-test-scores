"use strict";angular.module("teacherTestScoresApp",["ngRoute"]).config(["$locationProvider","$routeProvider",function(a,b){b.when("/",{templateUrl:"views/testlist.html",controller:"TestlistCtrl"}).when("/tests/:testName",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("teacherTestScoresApp").controller("MainCtrl",["$scope","testStorage","$routeParams",function(a,b,c){a.currentTest=c.testName,a.studentToAdd={name:"",score:""},a.students=b.getResults(a.currentTest)||[],a.setSummaryValues=function(b){var c,d=0,e=0,f="",g="";angular.forEach(b,function(a){c=parseFloat(a.score),d+=c||0,isNaN(c)||(e+=1,(""===f||f>c)&&(f=c),(""===g||c>g)&&(g=c))});var h=+(d/e).toFixed(2);a.avgScore=isNaN(h)?"":h,a.minScore=f,a.maxScore=g},a.setSummaryValues(a.students),a.$watch("students",function(c,d){c!==d&&(b.setResults(a.currentTest,a.students),a.setSummaryValues(c))},!0),a.addStudent=function(){a.students.unshift(angular.copy(a.studentToAdd)),a.studentToAdd.name="",a.studentToAdd.score=""},a.removeStudent=function(b){a.students.splice(b,1)},a.removeAll=function(){bootbox.confirm("Are you sure you want to remove all student test results?",function(b){b===!0&&(a.students=[],a.$apply())})}}]),angular.module("teacherTestScoresApp").directive("tsStudent",function(){return{templateUrl:"views/partials/student.html",restrict:"E"}}),angular.module("teacherTestScoresApp").service("testStorage",function(){function a(){return JSON.parse(localStorage.getItem(c)||"[]")}var b,c="teacher-test-storage-id";return{getTests:a,addTest:function(d){if(d===c)return!1;b=a();for(var e=0,f=b.length;f>e;++e)if(d===b[e])return!1;return b.unshift(d),localStorage.setItem(c,JSON.stringify(b)),!0},deleteTest:function(d){b=a();for(var e=0,f=b.length;f>e;++e)if(d===b[e])return b.splice(e,1),localStorage.setItem(c,JSON.stringify(b)),localStorage.removeItem(d),!0;return!1},getResults:function(a){return a&&a!==c?JSON.parse(localStorage.getItem(a)||"[]"):!1},setResults:function(a,b){if(a===c)return!1;var d=JSON.stringify(b,function(a,b){return"$$hashKey"===a?void 0:b});localStorage.setItem(a,d)},WARNING_SET_STORAGE_ID:function(a){c=a}}}),angular.module("teacherTestScoresApp").directive("tsSummary",function(){return{templateUrl:"views/partials/summary.html",restrict:"E"}}),angular.module("teacherTestScoresApp").controller("TestlistCtrl",["$scope","testStorage","$location",function(a,b,c){a.tests=b.getTests(),a.addFailure=!1,a.routeToTest=function(a){c.path("/tests/"+encodeURIComponent(a))},a.addTest=function(c){var d=b.addTest(c);d?a.routeToTest(c):a.addFailure=!0},a.removeTest=function(c){bootbox.confirm("Are you sure you want to remove this whole test and all the associated results?",function(d){if(d===!0){var e=b.deleteTest(a.tests[c]);e&&a.tests.splice(c,1)}})}}]);
